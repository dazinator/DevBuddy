version: '3.8'

services:
  headless-ide-mcp:
    image: headless-ide-mcp:dev
    container_name: headless-ide-mcp-server
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5000:8080"
      - "5001:8081"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_HTTP_PORTS=8080
      - ASPNETCORE_HTTPS_PORTS=8081
      - CODE_BASE_PATH=/workspace
    volumes:
      # Mount the sample codebase into the container
      - ./sample-codebase:/workspace:ro
    networks:
      - mcp-network
    # Security options
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 1G
        reservations:
          memory: 512M
    # Restart policy for OOM
    restart: unless-stopped

networks:
  mcp-network:
    driver: bridge
